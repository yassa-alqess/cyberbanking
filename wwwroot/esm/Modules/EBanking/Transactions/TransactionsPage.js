import{c as D,d as S,e as L,f as O,g as E,h as d,i as U}from"../../../_chunks/chunk-WRYVWBYB.js";import{a as c}from"../../../_chunks/chunk-O75CA257.js";import{a as l,c as h,d as R,f as B,g as T}from"../../../_chunks/chunk-BX2ZHUFS.js";var P=h(T(),1);var k=h(B(),1);var s=h(B(),1);var m=h(T(),1),x=h(T(),1);var f=class extends s.EntityDialog{constructor(){super(...arguments);this.form=new E(this.idPrefix)}getFormKey(){return E.formKey}getRowDefinition(){return d}getService(){return U.baseUrl}beforeLoadEntity(){super.beforeLoadEntity(this.entity),S.List({},i=>{this.senderAccounts=i.Entities;let o=this.form.SenderAccountType.items.filter(a=>this.senderAccounts.find(u=>u.AccountType===parseInt(a.id)));this.form.SenderAccountType.items=o}),S.ListByUsername({Username:x.Authorization.username},i=>{this.receiverAccounts=i.Entities;let o=this.form.ReceiverAccountType.items.filter(a=>this.receiverAccounts.find(u=>u.AccountType===parseInt(a.id)));this.form.ReceiverAccountType.items=o})}afterLoadEntity(){var a,u,A,g;super.afterLoadEntity(),this.form.TransactionType.changeSelect2(n=>{let p=(0,m.toId)(this.form.TransactionType.value);this.form.ReceiverAccountId.getGridField().toggle(p===3),this.form.ReceiverAccountType.getGridField().toggle(p===3)}),this.form.ReceiverAccountId.changeSelect2(n=>{let p=(0,m.toId)(this.form.ReceiverAccountId.value),w;S.ListById({Id:p},v=>{this.receiverAccounts=v.Entities;let t=this.form.ReceiverAccountType.items.filter(b=>this.receiverAccounts.find(I=>I.AccountType===parseInt(b.id)));console.log(t),this.form.ReceiverAccountType.items=t})});let i=(u=(0,m.tryFirst)((a=c.getLookup())==null?void 0:a.items,n=>n.Username===x.Authorization.username))==null?void 0:u.UserId,o=(g=(0,m.tryFirst)((A=c.getLookup())==null?void 0:A.items,n=>n.Username==="admin"))==null?void 0:g.UserId;i!==o&&i!=-1&&this.form.ReceiverAccountId.items.splice((0,m.indexOf)(this.form.ReceiverAccountId.items,n=>n.id===i.toString()),1)}updateInterface(){super.updateInterface(),this.isEditMode()&&(s.EditorUtils.setReadOnly(this.form.TransactionType,!0),s.EditorUtils.setReadOnly(this.form.Amount,!0),s.EditorUtils.setReadOnly(this.form.Description,!0),s.EditorUtils.setReadOnly(this.form.SenderAccountId,!0),s.EditorUtils.setReadOnly(this.form.SenderAccountType,!0),s.EditorUtils.setReadOnly(this.form.ReceiverAccountId,!0),s.EditorUtils.setReadOnly(this.form.ReceiverAccountType,!0),this.deleteButton.hide(),this.applyChangesButton.hide(),this.saveAndCloseButton.hide())}};l(f,"TransactionsDialog"),f=R([s.Decorators.registerClass("cyberbanking.EBanking.TransactionsDialog")],f);var r=h(T(),1);var y=class extends k.EntityGrid{getColumnsKey(){return O.columnsKey}getDialogType(){return f}getRowDefinition(){return d}getService(){return U.baseUrl}constructor(e){super(e)}getQuickFilters(){var u,A,g,n,p,w,v;let e=super.getQuickFilters();r.Authorization.hasPermission(L.Security)||e.splice((0,r.indexOf)(e,t=>t.field==d.Fields.SenderAccountId),1);let i=(A=(0,r.tryFirst)((u=c.getLookup())==null?void 0:u.items,t=>t.Username==="admin"))==null?void 0:A.UserId,o=(g=(0,r.tryFirst)(c.getLookup().items,t=>t.Username===r.Authorization.username))==null?void 0:g.UserId;i&&((p=c.getLookup())==null||p.items.splice((0,r.indexOf)((n=c.getLookup())==null?void 0:n.items,t=>t.UserId===i),1)),o!==i&&((v=c.getLookup())==null||v.items.splice((0,r.indexOf)((w=c.getLookup())==null?void 0:w.items,t=>t.UserId===o),1));let a=(0,r.first)(e,t=>t.field==d.Fields.ReceiverAccountId);return a.handler=t=>{var C;let b=t.request,I=t.widget.values;I[0]=(C=D.getLookup())==null?void 0:C.items.filter(F=>F.CustomerId===parseInt(I[0])).map(F=>F.AccountId).toString(),t.handled=!1},e}getQuickSearchFields(){let e=d.Fields,i=l(o=>(0,r.text)(`Db.${d.localTextPrefix}.${o}`).toLowerCase(),"txt");return[{name:"",title:"all"},{name:e.Description,title:i(e.Description)},{name:e.Amount,title:i(e.Amount)}]}getButtons(){let e=super.getButtons();return r.Authorization.hasPermission(L.Security)&&e.splice(0,1),e}getColumns(){let e=super.getColumns(),i=(0,r.first)(e,o=>o.field==d.Fields.SenderAccountId);return r.Authorization.hasPermission(L.Security)||(i.visible=!1),e}};l(y,"TransactionsGrid"),y=R([k.Decorators.registerClass("cyberbanking.EBanking.TransactionsGrid")],y);function K(){(0,P.initFullHeightGridPage)(new y($("#GridDiv")).element)}l(K,"pageInit");export{K as default};
//# sourceMappingURL=TransactionsPage.js.map
